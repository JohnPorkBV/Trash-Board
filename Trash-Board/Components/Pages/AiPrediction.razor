@page "/ai-predict"
@using TrashBoard.Models
@using TrashBoard.Services
@inject AiPredictionService AiService
@inject UserSessionService SessionService
@rendermode InteractiveServer
@if (!String.IsNullOrEmpty(SessionService.Username))
{
	<h3>AI Prediction</h3>

	<div class="form-group">
		<label>Humidity</label>
		<input type="number" @bind="input.Humidity" class="form-control" />
	</div>
	<div class="form-group">
		<label>Precipitation</label>
		<input type="number" step="0.1" @bind="input.Precipitation" class="form-control" />
	</div>
	<div class="form-group">
		<label>Temperature</label>
		<input type="number" step="0.1" @bind="input.Temp" class="form-control" />
	</div>
	<div class="form-group">
		<label>Windforce</label>
		<input type="number" step="0.1" @bind="input.Windforce" class="form-control" />
	</div>
	<div class="form-group form-check">
		<input type="checkbox" @bind="input.IsHoliday" class="form-check-input" />
		<label class="form-check-label">Is Holiday?</label>
	</div>
	<div class="form-group form-check">
		<input type="checkbox" @bind="input.isBredaEvent" class="form-check-input" />
		<label class="form-check-label">Is BredaEvent?</label>
	</div>

	<button class="btn btn-primary mt-2" @onclick="HandleSubmit">Predict</button>

	@if (result is not null)
	{
		<div class="alert alert-info mt-3">
			<strong>Prediction:</strong> @result
		</div>
	}
	<hr />
	<h4>7-Daagse Afvalvoorspelling</h4>
	<button class="btn btn-secondary" @onclick="Load7DayPrediction">Voorspel 7 dagen</button>

	@if (forecastResults is not null)
	{
		<table class="table table-striped mt-3">
			<thead>
				<tr>
					<th>Datum</th>
					<th>Voorspelde Hoeveelheid</th>
					<th>Afvaltype</th>
				</tr>
			</thead>
			<tbody>
				@foreach (var item in forecastResults)
				{
					<tr>
						<td>@item.date</td>
						<td>@item.predicted_trash_count</td>
						<td>@item.predicted_object</td>
					</tr>
				}
			</tbody>
		</table>
	}

}

@code {
	private TrashDetectionInput input = new();

	private string? result;

	private async Task HandleSubmit()
	{

		result = await AiService.PredictAsync(input);
		StateHasChanged();
	}
	protected override async Task OnAfterRenderAsync(bool firstRender)
	{
		if (firstRender)
		{
			await SessionService.InitializeAsync();
			StateHasChanged(); // refresh UI after loading session data
		}
	}
	private List<TrashBoard.Models.TrashForecastResult>? forecastResults;


	private async Task Load7DayPrediction()
	{
		try
		{
			forecastResults = await AiService.GetForecastAsync();
			StateHasChanged();
		}
		catch (Exception ex)
		{
			Console.WriteLine("Error getting forecast: " + ex.Message);
		}
	}

	

}
